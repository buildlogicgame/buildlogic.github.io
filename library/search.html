<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1080, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Build Logic - query</title>
    <link href="style.css" rel="stylesheet">
    <script async defer src="./../js/buttons.js"></script>
</head>

<body class="qbody">
    <div class="splash">
        <div class="static-bar">
            <a href="./../index.html" style="color:blue;margin:0px;padding:0px;font-size:2vw;position: relative;top:-0.2vh;left:1vw;font-weight: 700;text-shadow: 0px 0px 5px rgb(54, 54, 54);"><img style="position:relative;top:0.5vw;width:2vw;height:2vw;aspect-ratio: 1 1;filter: blur(0.1px) hue-rotate(289deg);" src="./../src/./BL.png"></img>Main Page</a>
            <a href="./index.html" style="margin:0px;padding:0px;color:blue;font-size:2vw;position: relative;top:-0.2vh;left:2vw;font-weight: 700;text-shadow: 0px 0px 5px rgb(54, 54, 54);">Search</a>
            <a style="color:lime;margin:0px;padding:0px;font-size:2vw;position: relative;top:-0.2vh;left:3vw;font-weight: 700;text-shadow: 0px 0px 5px black;">Library</a>

            <github><a class="github-button" href="https://github.com/buildlogicgame/buildlogicgame.github.io/discussions" data-color-scheme="no-preference: light; light: light; dark: light;" data-icon="octicon-comment-discussion" data-size="large" aria-label="Discuss buildlogicgame/buildlogicgame.github.io on GitHub">Discuss</a></github>
            <github2><a class="github-button" href="https://github.com/buildlogicgame/buildlogicgame.github.io/subscription" data-color-scheme="no-preference: light; light: light; dark: light;" data-icon="octicon-eye" data-size="large" data-show-count="false" aria-label="Watch buildlogicgame/buildlogicgame.github.io on GitHub">Watch</a></github2>
        </div>
        <h1 id="ysf" class="you-searched-for">Showing results for: </h1>
        <br><br>
        <div id="content" class="search-content">
            <div class="err-nocontent-hid" id="err">
                <div class="err-middle">
                    <br>
                    <h1>No Builds!</h1>
                    <hr style="position:relative;left:-2.9vw;width:91vw;border-color: red;">
                    <h1>Your search came back with no results</h1>
                    <br><br>
                    <a href="./index.html" style="color:blue;font-size: 3vw;">Go back to search.</a>
                </div>
            </div>
            <div class="err-nocontent-spacer-hid" id="errspace"></div>
            <br>
            <br>
            <br>
        </div>
    </div>
    <script>
        var idtable = {}
        setTimeout(function() {
            if(idtable == {}) {
                console.log("id table lost, reloading(possible preflight loop)")
                location.reload()
            } else {
                console.log("id table intact, no reload")
            }
        },10000)
        function copy(button) {
            console.log(idtable[button.parentElement.parentElement.id])
            navigator.clipboard.writeText(idtable[button.parentElement.parentElement.id].save);
            setTimeout(() => { alert("copied save to clipboard!") }, 300)
        }
        let query = decodeURIComponent(location.search.substring(3));
        if (query) {
            document.getElementById("ysf").innerHTML = "Showing results for: " + query
            fetch("http://user-bold.gl.at.ply.gg:16692/api/library/search?q=" + query + "&limit=50", {
                "headers": { 'Cache-Control': 'no-cache', 'Content-Type': 'application/json' },
                "method": "GET",
            }).then((result) => {
                const reader = result.body.getReader();
                reader.read().then(({ done, value }) => {
                    var json = new TextDecoder().decode(value)
                    if (json) {
                        json = JSON.parse(json)
                        if (json && json.result) {
                            json.result = JSON.parse(json.result)
                            if (Object.keys(json.result).length <= 0) {
                                document.getElementById("err").className = "err-nocontent-prime"
                                setTimeout(function () {
                                    document.getElementById("err").className = "err-nocontent"
                                    document.getElementById("errspace").className = "err-nocontent-spacer"
                                }, 50)
                            } else {
                                idtable = json.result
                                Object.keys(json.result).forEach((v) => {
                                    console.log("flight complete,search json:",v)

                                    const tex = `<div class="card cardscaler" id="${v}">
                <name>${json.result[v].name}</name><hr style="position:absolute;top:15%;width:99.6%;border-width:2px">
                <author>size:${json.result[v].save.length} | By:${json.result[v].author}</author>
                <description>${json.result[v].description || "no description"}</description>
                <copy><button onclick="copy(this)">COPY!</button></copy>
            </div>`
            document.getElementById("content").innerHTML += tex
                                })
                                document.getElementById("content").innerHTML += `<div class="err-nocontent-spacer" id="errspace"></div>`
                            }
                            console.log(json)
                        } else { setTimeout(() => { location.reload() }, 1000) }
                    } else { setTimeout(() => { location.reload() }, 1000) }
                });
            });
        } else {
            window.location.assign("./../index.html")
        }
    </script>
</body>

</html>